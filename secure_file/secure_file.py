# v1.4.0

import json
import random
import sys
from Crypto.Cipher import AES
from Crypto.Protocol.KDF import PBKDF2
from Crypto.Random import get_random_bytes
import os
from pathlib import Path
import base64
import shutil


def file_to_base64(filepath):
    with open(filepath, "rb") as f:
        encoded_bytes = base64.b64encode(f.read())
    return encoded_bytes.decode("utf-8")

def base64_to_file(base64_str, OUTPUT_FILEPATH):
    with open(OUTPUT_FILEPATH, "wb") as f:
        f.write(base64.b64decode(base64_str.encode("utf-8")))


def Suffix(path):
    return Path(path).suffix

DEBUG = True
p = "passwort"

alphabet = (
    [chr(i) for i in range(32, 217)] + ['\n', '\t', '√º', '√§', '√∂', '√ü']
)
encryption_chars = list("íÄÄíÄÅíÄÇíÄÉíÄÑíÄÖíÄÜíÄáíÄàíÄâíÄäíÄãíÄåíÄçíÄéíÄèíÄêíÄëíÄííÄìíÄîíÄïíÄñíÄóíÄòíÄôíÄöíÄõíÄúíÄùíÄûíÄüíÄ†íÄ°íÄ¢íÄ£íÄ§íÄ•íÄ¶íÄßíÄ®íÄ©íÄ™íÄ´íÄ¨íÄ≠íÄÆíÄØíÄ∞íÄ±íÄ≤íÄ≥íÄ¥íÄµíÄ∂íÄ∑íÄ∏íÄπíÄ∫íÄªíÄºíÄΩíÄæíÄøíÅÄíÅÅíÅÇíÅÉíÅÑíÅÖíÅÜíÅáíÅàíÅâíÅäíÅãíÅåíÅçíÅéíÅèíÅêíÅëíÅííÅìíÅîíÅïíÅñíÅóíÅòíÅôíÅöíÅõíÅúíÅùíÅûíÅüíÅ†íÅ°íÅ¢íÅ£íÅ§íÅ•íÅ¶íÅßíÅ®íÅ©íÅ™íÅ´íÅ¨íÅ≠íÅÆíÅØíÅ∞íÅ±íÅ≤íÅ≥íÅ¥íÅµíÅ∂íÅ∑íÅ∏íÅπíÅ∫íÅªíÅºíÅΩíÅæíÅøíÇÄíÇÅíÇÇíÇÉíÇÑíÇÖíÇÜíÇáíÇàíÇâíÇäíÇãíÇåíÇçíÇéíÇèíÇêíÇëíÇííÇìíÇîíÇïíÇñíÇóíÇòíÇôíÇöíÇõíÇúíÇùíÇûíÇüíÇ†íÇ°íÇ¢íÇ£íÇ§íÇ•íÇ¶íÇßíÇ®íÇ©íÇ™íÇ´íÇ¨íÇ≠íÇÆíÇØíÇ∞íÇ±íÇ≤íÇ≥íÇ¥íÇµíÇ∂íÇ∑íÇ∏íÇπíÇ∫íÇªíÇºíÇΩíÇæíÇøíÉÄíÉÅíÉÇíÉÉíÉÑíÉÖíÉÜíÉáíÉàíÉâíÉäíÉãíÉåíÉçíÉéíÉèíÉêíÉëíÉííÉìíÉîíÉïíÉñíÉóíÉòíÉôíÉöíÉõíÉúíÉùíÉûíÉüíÉ†íÉ°íÉ¢íÉ£íÉ§íÉ•íÉ¶íÉßíÉ®íÉ©íÉ™íÉ´íÉ¨íÉ≠íÉÆíÉØíÉ∞íÉ±íÉ≤íÉ≥íÉ¥íÉµíÉ∂íÉ∑íÉ∏íÉπíÉ∫íÉªíÉºíÉΩíÉæíÉøíÑÄíÑÅíÑÇíÑÉíÑÑíÑÖíÑÜíÑáíÑàíÑâíÑäíÑãíÑåíÑçíÑéíÑèíÑêíÑëíÑííÑìíÑîíÑïíÑñíÑóíÑòíÑôíÑöíÑõíÑúíÑùíÑûíÑüíÑ†íÑ°íÑ¢íÑ£íÑ§íÑ•íÑ¶íÑßíÑ®íÑ©íÑ™íÑ´íÑ¨íÑ≠íÑÆíÑØíÑ∞íÑ±íÑ≤íÑ≥íÑ¥íÑµíÑ∂íÑ∑íÑ∏íÑπíÑ∫íÑªíÑºíÑΩíÑæíÑøíÖÄíÖÅíÖÇíÖÉíÖÑíÖÖíÖÜíÖáíÖàíÖâíÖäíÖãíÖåíÖçíÖéíÖèíÖêíÖëíÖííÖìíÖîíÖïíÖñíÖóíÖòíÖôíÖöíÖõíÖúíÖùíÖûíÖüíÖ†íÖ°íÖ¢íÖ£íÖ§íÖ•íÖ¶íÖßíÖ®íÖ©íÖ™íÖ´íÖ¨íÖ≠íÖÆíÖØíÖ∞íÖ±íÖ≤íÖ≥íÖ¥íÖµíÖ∂íÖ∑íÖ∏íÖπíÖ∫íÖªíÖºíÖΩíÖæíÖøíÜÄíÜÅíÜÇíÜÉíÜÑíÜÖíÜÜíÜáíÜàíÜâíÜäíÜãíÜåíÜçíÜéíÜèíÜêíÜëíÜííÜìíÜîíÜïíÜñíÜóíÜòíÜôíÜöíÜõíÜúíÜùíÜûíÜüíÜ†íÜ°íÜ¢íÜ£íÜ§íÜ•íÜ¶íÜßíÜ®íÜ©íÜ™íÜ´íÜ¨íÜ≠íÜÆíÜØíÜ∞íÜ±íÜ≤íÜ≥íÜ¥íÜµíÜ∂íÜ∑íÜ∏íÜπíÜ∫íÜªíÜºíÜΩíÜæíÜøíáÄíáÅíáÇíáÉíáÑíáÖíáÜíááíáàíáâíáäíáãíáåíáçíáéíáèíáêíáëíáííáìíáîíáïíáñíáóíáòíáôíáöíáõíáúíáùíáûíáüíá†íá°íá¢íá£íá§íá•íá¶íáßíá®íá©íá™íá´íá¨íá≠íáÆíáØíá∞íá±íá≤íá≥íá¥íáµíá∂íá∑íá∏íáπíá∫íáªíáºíáΩíáæíáøíàÄíàÅíàÇíàÉíàÑíàÖíàÜíàáíààíàâíàäíàãíàåíàçíàéíàèíàêíàëíàííàìíàîíàïíàñíàóíàòíàôíàöíàõíàúíàùíàûíàüíà†íà°íà¢íà£íà§íà•íà¶íàßíà®íà©íà™íà´íà¨íà≠íàÆíàØíà∞íà±íà≤íà≥íà¥íàµíà∂íà∑íà∏íàπíà∫íàªíàºíàΩíàæíàøíâÄíâÅíâÇíâÉíâÑíâÖíâÜíâáíâàíââíâäíâãíâåíâçíâéíâèíâêíâëíâííâìíâîíâïíâñíâóíâòíâôíâöíâõíâúíâùíâûíâüíâ†íâ°íâ¢íâ£íâ§íâ•íâ¶íâßíâ®íâ©íâ™íâ´íâ¨íâ≠íâÆíâØíâ∞íâ±íâ≤íâ≥íâ¥íâµíâ∂íâ∑íâ∏íâπíâ∫íâªíâºíâΩíâæíâøíäÄíäÅíäÇíäÉíäÑíäÖíäÜíäáíäàíäâíääíäãíäåíäçíäéíäèíäêíäëíäííäìíäîíäïíäñíäóíäòíäôíäöíäõíäúíäùíäûíäüíä†íä°íä¢íä£íä§íä•íä¶íäßíä®íä©íä™íä´íä¨íä≠íäÆíäØíä∞íä±íä≤íä≥íä¥íäµíä∂íä∑íä∏íäπíä∫íäªíäºíäΩíäæíäøíãÄíãÅíãÇíãÉíãÑíãÖíãÜíãáíãàíãâíãäíããíãåíãçíãéíãèíãêíãëíãííãìíãîíãïíãñíãóíãòíãôíãöíãõíãúíãùíãûíãüíã†íã°íã¢íã£íã§íã•íã¶íãßíã®íã©íã™íã´íã¨íã≠íãÆíãØíã∞íã±íã≤íã≥íã¥íãµíã∂íã∑íã∏íãπíã∫íãªíãºíãΩíãæíãøíåÄíåÅíåÇíåÉíåÑíåÖíåÜíåáíåàíåâíåäíåãíååíåçíåéíåèíåêíåëíåííåìíåîíåïíåñíåóíåòíåôíåöíåõíåúíåùíåûíåüíå†íå°íå¢íå£íå§íå•íå¶íåßíå®íå©íå™íå´íå¨íå≠íåÆíåØíå∞íå±íå≤íå≥íå¥íåµíå∂íå∑íå∏íåπíå∫íåªíåºíåΩíåæíåøíçÄíçÅíçÇíçÉíçÑíçÖíçÜíçáíçàíçâíçäíçãíçåíççíçéíçèíçêíçëíçííçìíçîíçïíçñíçóíçòíçôíçöíçõíçúíçùíçûíçüíç†íç°íç¢íç£íç§íç•íç¶íçßíç®íç©íç™íç´íç¨íç≠íçÆíçØíç∞íç±íç≤íç≥íç¥íçµíç∂íç∑íç∏íçπíç∫íçªíçºíçΩíçæíçøíéÄíéÅíéÇíéÉíéÑíéÖíéÜíéáíéàíéâíéäíéãíéåíéçíééíéèíéêíéëíéííéìíéîíéïíéñíéóíéòíéôêÇÄêÇÅêÇÇêÇÉêÇÑêÇÖêÇÜêÇáêÇàêÇâêÇäêÇãêÇåêÇçêÇéêÇèêÇêêÇëêÇíêÇìêÇîêÇïêÇñêÇóêÇòêÇôêÇöêÇõêÇúêÇùêÇûêÇüêÇ†êÇ°êÇ¢êÇ£êÇ§êÇ•êÇ¶êÇßêÇ®êÇ©êÇ™êÇ´êÇ¨êÇ≠êÇÆêÇØêÇ∞êÇ±êÇ≤êÇ≥êÇ¥êÇµêÇ∂êÇ∑êÇ∏êÇπêÇ∫êÇªêÇºêÇΩêÇæêÇøêÉÄêÉÅêÉÇêÉÉêÉÑêÉÖêÉÜêÉáêÉàêÉâêÉäêÉãêÉåêÉçêÉéêÉèêÉêêÉëêÉíêÉìêÉîêÉïêÉñêÉóêÉòêÉôêÉöêÉõêÉúêÉùêÉûêÉüêÉ†êÉ°êÉ¢êÉ£êÉ§êÉ•êÉ¶êÉßêÉ®êÉ©êÉ™êÉ´êÉ¨êÉ≠êÉÆêÉØêÉ∞êÉ±êÉ≤êÉ≥êÉ¥êÉµêÉ∂êÉ∑êÉ∏êÉπêÉ∫ê§Äê§Åê§Çê§Éê§Ñê§Öê§Üê§áê§àê§âê§äê§ãê§åê§çê§éê§èê§êê§ëê§íê§ìê§ñê§óê§òê§ôê§öê§õê§üê†Äê†Åê†Çê†Éê†Ñê†Öê†àê†äê†ãê†åê†çê†éê†èê†êê†ëê†íê†ìê†îê†ïê†ñê†óê†òê†ôê†öê†õê†úê†ùê†ûê†üê††ê†°ê†¢ê†£ê†§ê†•ê†¶ê†ßê†®ê†©ê†™ê†´ê†¨ê†≠ê†Æê†Øê†∞ê†±ê†≤ê†≥ê†¥ê†µê†∑ê†∏ê†ºê†øìÄÄìÄÅìÄÇìÄÉìÄÑìÄÖìÄÜìÄáìÄàìÄâìÄäìÄãìÄåìÄçìÄéìÄèìÄêìÄëìÄíìÄììÄîìÄïìÄñìÄóìÄòìÄôìÄöìÄõìÄúìÄùìÄûìÄüìÄ†ìÄ°ìÄ¢ìÄ£ìÄ§ìÄ•ìÄ¶ìÄßìÄ®ìÄ©ìÄ™ìÄ´ìÄ¨ìÄ≠ìÄÆìÄØìÄ∞ìÄ±ìÄ≤ìÄ≥ìÄ¥ìÄµìÄ∂ìÄ∑ìÄ∏ìÄπìÄ∫ìÄªìÄºìÄΩìÄæìÄøìÅÄìÅÅìÅÇìÅÉìÅÑìÅÖìÅÜìÅáìÅàìÅâìÅäìÅãìÅåìÅçìÅéìÅèìÅêìÅëìÅíìÅììÅîìÅïìÅñìÅóìÅòìÅôìÅöìÅõìÅúìÅùìÅûìÅüìÅ†ìÅ°ìÅ¢ìÅ£ìÅ§ìÅ•ìÅ¶ìÅßìÅ®ìÅ©ìÅ™ìÅ´ìÅ¨ìÅ≠ìÅÆìÅØìÅ∞ìÅ±ìÅ≤ìÅ≥ìÅ¥ìÅµìÅ∂ìÅ∑ìÅ∏ìÅπìÅ∫ìÅªìÅºìÅΩìÅæìÅøìÇÄìÇÅìÇÇìÇÉìÇÑìÇÖìÇÜìÇáìÇàìÇâìÇäìÇãìÇåìÇçìÇéìÇèìÇêìÇëìÇíìÇììÇîìÇïìÇñìÇóìÇòìÇôìÇöìÇõìÇúìÇùìÇûìÇüìÇ†ìÇ°ìÇ¢ìÇ£ìÇ§ìÇ•ìÇ¶ìÇßìÇ®ìÇ©ìÇ™ìÇ´ìÇ¨ìÇ≠ìÇÆìÇØìÇ∞ìÇ±ìÇ≤ìÇ≥ìÇ¥ìÇµìÇ∂ìÇ∑ìÇ∏ìÇ∫ìÇªìÇºìÇΩìÇæìÇøìÉÄìÉÅìÉÇìÉÉìÉÑìÉÖìÉÜìÉáìÉàìÉâìÉäìÉãìÉåìÉçìÉéìÉèìÉêìÉëìÉíìÉììÉîìÉïìÉñìÉóìÉòìÉôìÉöìÉõìÉúìÉùìÉûìÉüìÉ†ìÉ°ìÉ¢ìÉ£ìÉ§ìÉ•ìÉ¶ìÉßìÉ®ìÉ©ìÉ™ìÉ´ìÉ¨ìÉ≠ìÉÆìÉØìÉ∞ìÉ±ìÉ≤ìÉ≥ìÉ¥ìÉµìÉ∂ìÉ∑ìÉ∏ìÉπìÉ∫ìÉªìÉºìÉΩìÉæìÉøìÑÄìÑÅìÑÇìÑÉìÑÑìÑÖìÑÜìÑáìÑàìÑâìÑäìÑãìÑåìÑçìÑéìÑèìÑêìÑëìÑíìÑììÑîìÑïìÑñìÑóìÑòìÑôìÑöìÑõìÑúìÑùìÑûìÑüìÑ†ìÑ°ìÑ¢ìÑ£ìÑ§ìÑ•ìÑ¶ìÑßìÑ®ìÑ©ìÑ™ìÑ´ìÑ¨ìÑ≠ìÑÆìÑØìÑ∞ìÑ±ìÑ≤ìÑ≥ìÑ¥ìÑµìÑ∂ìÑ∑ìÑ∏ìÑπìÑ∫ìÑªìÑºìÑΩìÑæìÑøìÖÄìÖÅìÖÇìÖÉìÖÑìÖÖìÖÜìÖáìÖàìÖâìÖäìÖãìÖåìÖçìÖéìÖèìÖêìÖëìÖíìÖììÖîìÖïìÖñìÖóìÖòìÖôìÖöìÖõìÖúìÖùìÖûìÖüìÖ†ìÖ°ìÖ¢ìÖ£ìÖ§ìÖ•ìÖ¶ìÖßìÖ®ìÖ©ìÖ™ìÖ´ìÖ¨ìÖ≠ìÖÆìÖØìÖ∞ìÖ±ìÖ≤ìÖ≥ìÖ¥ìÖµìÖ∂ìÖ∑ìÖ∏ìÖπìÖ∫ìÖªìÖºìÖΩìÖæìÖøìÜÄìÜÅìÜÇìÜÉìÜÑìÜÖìÜÜìÜáìÜàìÜâìÜäìÜãìÜåìÜçìÜéìÜèìÜêìÜëìÜíìÜììÜîìÜïìÜñìÜóìÜòìÜôìÜöìÜõìÜúìÜùìÜûìÜüìÜ†ìÜ°ìÜ¢ìÜ£ìÜ§ìÜ•ìÜ¶ìÜßìÜ®ìÜ©ìÜ™ìÜ´ìÜ¨ìÜ≠ìÜÆìÜØìÜ∞ìÜ±ìÜ≤ìÜ≥ìÜ¥ìÜµìÜ∂ìÜ∑ìÜ∏ìÜπìÜ∫ìÜªìÜºìÜΩìÜæìÜøìáÄìáÅìáÇìáÉìáÑìáÖìáÜìááìáàìáâìáäìáãìáåìáçìáéìáèìáêìáëìáíìáììáîìáïìáñìáóìáòìáôìáöìáõìáúìáùìáûìáüìá†ìá°ìá¢ìá£ìá§ìá•ìá¶ìáßìá®ìá©ìá™ìá´ìá¨ìá≠ìáÆìáØìá∞ìá±ìá≤ìá≥ìá¥ìáµìá∂ìá∑ìá∏ìáπìá∫ìáªìáºìáΩìáæìáøìàÄìàÅìàÇìàÉìàÑìàÖìàÜìàáìààìàâìàäìàãìàåìàçìàéìàèìàêìàëìàíìàììàîìàïìàñìàóìàòìàôìàöìàõìàúìàùìàûìàüìà†ìà°ìà¢ìà£ìà§ìà•ìà¶ìàßìà®ìà©ìà™ìà´ìà¨ìà≠ìàÆìàØìà∞ìà±ìà≤ìà≥ìà¥ìàµìà∂Uìà∑ìà∏ìàπìà∫ìàªìàºìàΩìàæìàøìâÄìâÅìâÇìâÉìâÑìâÖìâÜìâáìâàìââìâäìâãìâåìâçìâéìâèìâêìâëìâíìâììâîìâïìâñìâóìâòìâôìâöìâõìâúìâùìâûìâüìâ†ìâ°ìâ¢ìâ£ìâ§ìâ•ìâ¶ìâßìâ®ìâ©ìâ™ìâ´ìâ¨ìâ≠ìâÆìâØìâ∞ìâ±ìâ≤ìâ≥ìâ¥ìâµìâ∂ìâ∑ìâ∏ìâπìâ∫ìâªìâºìâΩìâæìâøìäÄìäÅìäÇìäÉìäÑìäÖìäÜìäáìäàìäâìääìäãìäåìäçìäéìäèìäêìäëìäíìäììäîìäïìäñìäóìäòìäôìäöìäõìäúìäùìäûìäüìä†ìä°ìä¢ìä£ìä§ìä•ìä¶ìäßìä®ìä©ìä™ìä´ìä¨ìä≠ìäÆìäØìä∞ìä±ìä≤ìä≥ìä¥ìäµìä∂ìä∑ìä∏ìäπìä∫ìäªìäºìäΩìäæìäøìãÄìãÅìãÇìãÉìãÑìãÖìãÜìãáìãàìãâìãäìããìãåìãçìãéìãèìãêìãëìãíìãììãîìãïìãñìãóìãòìãôìãöìãõìãúìãùìãûìãüìã†ìã°ìã¢ìã£ìã§ìã•ìã¶ìãßìã®ìã©ìã™ìã´ìã¨ìã≠ìãÆìãØìã∞ìã±ìã≤ìã≥ìã¥ìãµìã∂ìã∑ìã∏ìãπìã∫ìãªìãºìãΩìãæìãøìåÄìåÅìåÇìåÉìåÑìåÖìåÜìåáìåàìåâìåäìåãìååìåçìåéìåèìåêìåëìåíìåììåîìåïìåñìåóìåòìåôìåöìåõìåúìåùìåûìåüìå†ìå°ìå¢ìå£ìå§ìå•ìå¶ìåßìå®ìå©ìå™ìå´ìå¨ìå≠ìåÆìåØìå∞ìå±ìå≤ìå≥ìå¥ìåµìå∂ìå∑ìå∏ìåπìå∫ìåªìåºìåΩìåæìåøìçÄìçÅìçÇìçÉìçÑìçÖìçÜìçáìçàìçâìçäìçãìçåìççìçéìçèìçêìçëìçíìçììçîìçïìçñìçóìçòìçôìçöìçõìçúìçùìçûìçüìç†ìç°ìç¢ìç£ìç§ìç•ìç¶ìçßìç®ìç©ìç™ìç´ìç¨ìç≠ìçÆìçØìç∞ìç±ìç≤ìç≥ìç¥ìçµìç∂ìç∑ìç∏ìçπìç∫ìçªìçºìçΩìçæìçøìéÄìéÅìéÇìéÉìéÑìéÖìéÜìéáìéàìéâìéäìéãìéåìéçìééìéèìéêìéëìéíìéììéîìéïìéñìéóìéòìéôìéöìéõìéúìéùìéûìéüìé†ìé°ìé¢ìé£ìé§ìé•ìé¶ìéßìé®ìé©ìé™ìé´ìé¨ìé≠ìéÆìéØìé∞ìé±ìé≤ìé≥ìé¥ìéµìé∂ìé∑ìé∏ìéπìé∫ìéªìéºìéΩìéæìéøìèÄìèÅìèÇìèÉìèÑìèÖìèÜìèáìèàìèâìèäìèãìèåìèçìèéìèèìèêìèëìèíìèììèîìèïìèñìèóìèòìèôìèöìèõìèúYìèùìèûìèüìè†ìè°ìè¢ìè£ìè§ìè•ìè¶ìèßìè®ìè©ìè™ìè´ìè¨ìè≠ìèÆìèØìè∞ìè±ìè≤ìè≥ìè¥ìèµìè∂ìè∑ìè∏ìèπìè∫ìèªìèΩìèæìèøìêÄìêÅìêÇìêÉìêÑìêÖìêÜìêáìêàìêâìêäìêãìêåìêçìêéìêèìêêìêëìêíìêììêîìêïìêñìêóìêòìêôìêöìêõìêúìêùìêûìêüìê†ìê°ìê¢ìê£ìê§ìê•ìê¶ìêßìê®ìê©ìê™ìê´ìê¨ìê≠ìêÆüúÄüúÅüúÇüúÉüúÑüúÖüúÜüúáüúàüúâüúäüúãüúåüúçüúéüúèüúêüúëüúíüúìüúîüúïüúñüúóüúòüúôüúöüúõüúúüúùüúûüúüüú†üú°üú¢üú£üú§üú•üú¶üúßüú®üú©üú™üú´üú¨üú≠üúÆüúØüú∞üú±üú≤üú≥üú¥üúµüú∂üú∑üú∏üúπüú∫üúªüúºüúΩüúæüúøüùÄüùÅüùÇüùÉüùÑüùÖüùÜüùáüùàüùâüùäüùãüùçüùéüùèüùêüùëüùíüùìüùîüùïüùñüùóüùòüùôüùöüùõüùúüùùüùûüùüüù†üù°üù¢üù£üù§üù•üù¶üùßüù©üù™üù´üù¨üù≠üùÆüùØüù∞üù±üù≤üù≥üô™üô´üô¨üô≠üôÆüôØüô∞üô±üô≤üô≥üô¥üôµüô∂üô∑üô∏üôπüô∫üôªüôºüôΩüôæüôøñ†Äñ†Åñ†Çñ†Éñ†Ññ†Öñ†Üñ†áñ†àñ†âñ†äñ†ãñ†åñ†çñ†éñ†èñ†êñ†ëñ†íQñ†ìñ†îñ†ïñ†ññ†óñ†òñ†ôñ†öñ†õñ†úñ†ùñ†ûñ†üñ††ñ†°ñ†¢ñ†£ñ†§ñ†•ñ†¶ñ†ßñ†®ñ†©ñ†™ñ†´ñ†¨ñ†≠ñ†Æñ†Øñ†∞ñ†±ñ†≤ñ†≥ñ†¥ñ†µñ†∂ñ†∑ñ†∏ñ†πñ†∫ñ†ªñ†ºñ†Ωñ†æñ†øñ°Äñ°Åñ°Çñ°Éñ°Ññ°Öñ°Üñ°áñ°àñ°âñ°äñ°ãñ°åñ°çñ°éñ°èñ°êñ°ëñ°íñ°ìñ°îñ°ïñ°ññ°óñ°òñ°ôñ°öñ°õñ°úñ°ùñ°ûñ°üñ°†ñ°°ñ°¢ñ°£ñ°§ñ°•ñ°¶ñ°ßñ°®ñ°©ñ°™ñ°´ñ°¨ñ°≠ñ°Æñ°Øñ°∞ñ°±ñ°≤ñ°≥ñ°¥ñ°µñ°∂ñ°∑ñ°∏ñ°πñ°∫ñ°ªñ°ºñ°Ωñ°æñ°øñ¢Äñ¢Åñ¢Çñ¢Éñ¢Ññ¢Öñ¢Üñ¢áñ¢àñ¢âñ¢äñ¢ãñ¢åñ¢çñ¢éñ¢èñ¢êñ¢ëñ¢íñ¢ìñ¢îñ¢ïñ¢ññ¢óñ¢òñ¢ôñ¢öñ¢õñ¢úñ¢ùñ¢ûñ¢üñ¢†ñ¢°ñ¢¢ñ¢£ñ¢§ñ¢•ñ¢¶ñ¢ßñ¢®ñ¢©ñ¢™ñ¢´ñ¢¨ñ¢≠ñ¢Æñ¢Øñ¢∞ñ¢±ñ¢≤ñ¢≥ñ¢¥ñ¢µñ¢∂ñ¢∑ñ¢∏ñ¢πñ¢∫ñ¢ªñ¢ºñ¢Ωñ¢æñ¢øñ£Äñ£Åñ£Çñ£Éñ£Ññ£Öñ£Üñ£áñ£àñ£âñ£äñ£ãñ£åñ£çñ£éñ£èñ£êñ£ëñ£íñ£ìñ£îñ£ïñ£ññ£óñ£òñ£ôñ£öñ£õñ£úñ£ùñ£ûñ£üñ£†ñ£°ñ£¢ñ££ñ£§ñ£•ñ£¶ñ£ßñ£®ñ£©ñ£™ñ£´ñ£¨ñ£≠ñ£Æñ£Øñ£∞ñ£±ñ£≤ñ£≥ñ£¥ñ£µñ£∂ñ£∑ñ£∏ñ£πñ£∫ñ£ªñ£ºñ£Ωñ£æñ£øñ§Äñ§Åñ§Çñ§Éñ§Ññ§Öñ§Üñ§áñ§àñ§âñ§äñ§ãñ§åñ§çñ§éñ§èñ§êñ§ëñ§íñ§ìñ§îñ§ïñ§ññ§óñ§òñ§ôñ§öñ§õñ§úñ§ùñ§ûñ§üñ§†ñ§°ñ§¢ñ§£ñ§§ñ§•ñ§¶ñ§ßñ§®ñ§©ñ§™ñ§´ñ§¨ñ§≠ñ§Æñ§Øñ§∞ñ§±ñ§≤ñ§≥ñ§¥ñ§µñ§∂ñ§∑ñ§∏ñ§πñ§∫ñ§ªñ§ºñ§Ωñ§æñ§øñ•Äñ•Åñ•Çñ•Éñ•Ññ•Öñ•Üñ•áñ•àñ•âñ•äñ•ãñ•åñ•çñ•éñ•èñ•êñ•ëñ•íñ•ìñ•îñ•ïñ•ññ•óñ•òñ•ôñ•öñ•õñ•úñ•ùñ•ûñ•üñ•†ñ•°ñ•¢ñ•£ñ•§ñ••ñ•¶ñ•ßñ•®ñ•©ñ•™ñ•´ñ•¨ñ•≠ñ•Æñ•Øñ•∞ñ•±ñ•≤ñ•≥ñ•¥ñ•µñ•∂ñ•∑ñ•∏ñ•πñ•∫ñ•ªñ•ºñ•Ωñ•æñ•øñ¶Äñ¶Åñ¶Çñ¶Éñ¶Ññ¶Öñ¶Üñ¶áñ¶àñ¶âñ¶äñ¶ãñ¶åñ¶çñ¶éñ¶èñ¶êñ¶ëñ¶íñ¶ìñ¶îñ¶ïñ¶ññ¶óñ¶òñ¶ôñ¶öñ¶õñ¶úñ¶ùñ¶ûñ¶üñ¶†ñ¶°ñ¶¢ñ¶£ñ¶§ñ¶•ñ¶¶ñ¶ßñ¶®ñ¶©ñ¶™ñ¶´ñ¶¨ñ¶≠ñ¶Æñ¶Øñ¶∞ñ¶±ñ¶≤ñ¶≥ñ¶¥ñ¶µñ¶∂ñ¶∑ñ¶∏ñ¶πñ¶∫ñ¶ªñ¶ºñ¶Ωñ¶æñ¶øñßÄñßÅñßÇñßÉñßÑñßÖñßÜñßáñßàñßâñßäñßãñßåñßçñßéñßèñßêñßëñßíñßìñßîñßïñßññßóñßòñßôñßöñßõñßúñßùñßûñßüñß†ñß°ñß¢ñß£ñß§ñß•ñß¶ñßßñß®ñß©ñß™ñß´ñß¨ñß≠ñßÆñßØñß∞ñß±ñß≤ñß≥ñß¥ñßµñß∂ñß∑ñß∏ñßπñß∫ñßªñßºñßΩñßæñßøñ®Äñ®Åñ®Çñ®Éñ®Ññ®Öñ®Üñ®áñ®àñ®âñ®äñ®ãñ®åñ®çñ®éñ®èñ®êñ®ëñ®íñ®ìñ®îñ®ïñ®ññ®óñ®òñ®ôñ®öñ®õñ®úñ®ùñ®ûñ®üñ®†ñ®°ñ®¢ñ®£ñ®§ñ®•ñ®¶ñ®ßñ®®ñ®©ñ®™ñ®´ñ®¨ñ®≠ñ®Æñ®Øñ®∞ñ®±ñ®≤ñ®≥ñ®¥ñ®µñ®∂ñ®∑ñ®∏üÇ†üÇ°üÇ¢üÇ£üÇ§üÇ•üÇ¶üÇßüÇ®üÇ©üÇ™üÇ´üÇ¨üÇ≠üÇÆüÇ±üÇ≤üÇ≥üÇ¥üÇµüÇ∂üÇ∑üÇ∏üÇπüÇ∫üÇªüÇºüÇΩüÇæüÇøüÉÅüÉÇüÉÉüÉÑüÉÖüÉÜüÉáüÉàüÉâüÉäüÉãüÉåüÉçüÉéüÉëüÉíüÉìüÉîüÉïüÉñüÉóüÉòüÉôüÉöüÉõüÉúüÉùüÉûüÉüüÉ†üÉ°üÉ¢üÉ£üÉ§üÉ•üÉ¶üÉßüÉ®üÉ©üÉ´üÉ™üÉ¨üÉ≠üÉÆüÉØüÉ∞üÉ±üÉ≤üÉ≥üÉ¥üÉµ")
def secure_path():
    if hasattr(sys, 'real_prefix') or (hasattr(sys, 'base_prefix') and sys.base_prefix != sys.prefix):
        base = sys.prefix
    elif 'VIRTUAL_ENV' in os.environ:
        base = os.environ['VIRTUAL_ENV']
    else:
        base = os.getcwd()
    return os.path.join(base, "Lib", "site-packages", "secure_file", "secure") + os.sep

def alphabet_2_charset(secure): return ''.join([encryption_chars[alphabet.index(c)] if c in alphabet else '[UNKOWN]' for c in secure])
def charset_2_alphabet(secure): return ''.join([alphabet[encryption_chars.index(c)] if c in encryption_chars else '[UNKOWN]' for c in secure])

def CREATE_RANDOM_MAPPING():
    shuffled_chars = encryption_chars[:]
    random.shuffle(shuffled_chars)
    return {alphabet[i]: shuffled_chars[i] for i in range(len(alphabet))}

def CHECK_FILE_EXISTENSE(filepath):
    if not os.path.exists(filepath): raise FileNotFoundError(f"Datei {filepath} wurde nicht gefunden.")

def SAVE_MAPPING(mapping, file):
    obfuscated_mapping = {alphabet_2_charset(k): v for k, v in mapping.items()}
    suffix = Suffix(file)
    file_path = secure_path() + "data\\" + file.removesuffix(suffix) + ".json"
    os.makedirs(os.path.dirname(file_path), exist_ok=True)
    with open(file_path, "w", encoding="utf-8") as f:
        json.dump(obfuscated_mapping, f, ensure_ascii=False)

def LOAD_MAPPING(file):
    suffix = Suffix(file)
    file_path = secure_path() + file.removesuffix(suffix) + ".json"
    with open(file_path, "r", encoding="utf-8") as f:
        obfuscated_mapping = json.load(f)
    return {charset_2_alphabet(k): v for k, v in obfuscated_mapping.items()}

def ENCODE_TEXT(text, mapping):
    return ''.join(mapping.get(c, '[UNKNOWN]') for c in text)

def DECODE_TEXT(text, mapping):
    reverse_mapping = {v: k for k, v in mapping.items()}
    return ''.join(reverse_mapping.get(c, '?') for c in text)


def ENCODE_FILE(file, mapping, path):
    suffix = Suffix(file)
    base64_str = file_to_base64(file)  # 1. Datei zu Base64
    full_path = os.path.abspath(file)
    ENCODED_PATH = ENCODE_TEXT(full_path, mapping)
    
    ENCODED_BODY = ENCODE_TEXT(base64_str, mapping)  # 2. Base64-Text codieren
    OUTPUT_STRING = f"‚°á{suffix}‚°Ü{ENCODED_PATH}‚°á{ENCODED_BODY}"

    OUTPUT_FILE = secure_path() + "data\\" + file.removesuffix(suffix) + ".scff"
    os.makedirs(os.path.dirname(OUTPUT_FILE), exist_ok=True)

    with open(OUTPUT_FILE, "w", encoding="utf-8") as f:
        f.write(OUTPUT_STRING)

    print("Datei erfolgreich codiert.")

def OPEN_ENCODED_FILE(file):
    suffix = Suffix(file)
    file = secure_path() + "data\\" + file.removesuffix(suffix) + ".scff"
    with open(file, "r", encoding="utf-8") as f:
        return f.read()



def ENCODE_MAIN_DELETE(filename: str):
    path = filename
    full_path = os.path.abspath(filename)
    suffix = Suffix(filename)
    MAPPING = CREATE_RANDOM_MAPPING()
    SAVE_MAPPING(MAPPING, filename)

    json_path = secure_path() + "data\\" + filename.removesuffix(suffix) + ".json"
    enc_path = json_path.removesuffix(".json") + ".enc"

    if DEBUG:
        print(f"path:  {path}")
        print(f"full_path:  {full_path}")
        print(f"json_path:  {json_path}")
        print(f"enc_path:  {enc_path}")


    with open(json_path, "rb") as f:
        json_data = f.read()

    salt = get_random_bytes(16)
    key = PBKDF2(p, salt, dkLen=32, count=100_000)
    cipher = AES.new(key, AES.MODE_GCM)
    ciphertext, tag = cipher.encrypt_and_digest(json_data)

    with open(enc_path, "wb") as f:
        f.write(salt + cipher.nonce + tag + ciphertext)
    
    

        
    os.remove(json_path)
    ENCODE_FILE(full_path, MAPPING, path)
    #os.remove(full_path)




def ENCODE_FOLDER_RECURSIVE(root_folder: str, remove = False):
    for dirpath, dirnames, filenames in os.walk(root_folder):
        for filename in filenames:
            full_path = os.path.join(dirpath, filename)
            try:
                print(f"Verschl√ºssele: {full_path}")
                ENCODE_MAIN_DELETE(full_path)
            except Exception as e:
                print(f"Fehler beim Verschl√ºsseln von {full_path}: {e}")
    if remove:
        #shutil.rmtree(root_folder)
        print("removed folder")







def DECODE_MAIN_SAFE(filepath_or_name: str, cleanup=False, namespace=globals()):
    import os

    if os.path.isfile(filepath_or_name) and filepath_or_name.endswith(".scff"):
        code_path = filepath_or_name
        filename = os.path.splitext(os.path.basename(filepath_or_name))[0]
    else:
        # Fallback: relativ zu secure_path()/data/
        code_path = os.path.join(secure_path(), "data", filepath_or_name + ".scff")
        filename = filepath_or_name

    with open(code_path, "r", encoding="utf-8") as file:
        coded_text = file.read()

    try:
        first_marker = coded_text.index("‚°á")
        second_marker = coded_text.index("‚°á", first_marker + 1)

        header_and_sections = coded_text[first_marker + 1:second_marker]
        ENCODED_BODY = coded_text[second_marker + 1:]

        header_parts = [seg.strip() for seg in header_and_sections.split("‚°Ü")]
        header = header_parts[0]
        path_sections = header_parts[1:] if len(header_parts) > 1 else []

    except ValueError:
        raise ValueError("Header konnte nicht gelesen werden.")

    enc_path = os.path.join(os.path.dirname(code_path), filename + ".enc")

    with open(enc_path, "rb") as file:
        data = file.read()

    salt = data[:16]
    nonce = data[16:32]
    tag = data[32:48]
    ciphertext = data[48:]
    key = PBKDF2(p, salt, dkLen=32, count=100_000)
    cipher = AES.new(key, AES.MODE_GCM, nonce=nonce)
    raw_json = cipher.decrypt_and_verify(ciphertext, tag)
    mapping = json.loads(raw_json.decode("utf-8"))

    reverse_mapping = {v: charset_2_alphabet(k) for k, v in mapping.items()}

    try:
        decoded_base64 = ''.join(reverse_mapping[c] for c in ENCODED_BODY)
    except KeyError as e:
        raise ValueError(f"Zeichen im Body nicht im Mapping gefunden: {e}")

    missing_padding = len(decoded_base64) % 4
    if missing_padding:
        decoded_base64 += "=" * (4 - missing_padding)

    def decode_path_sections(sections, rev_map):
        decoded_parts = []
        for sec in sections:
            try:
                decoded_sec = ''.join(rev_map[c] for c in sec)
                decoded_parts.append(decoded_sec)
            except KeyError as e:
                print(f"Warnung: Pfadzeichen nicht gefunden: {e}")
                decoded_parts.append(sec)  # fallback: unver√§ndert
        return os.path.join(*decoded_parts) if decoded_parts else os.path.join(secure_path(), "data")

    DECODED_PATH = decode_path_sections(path_sections, reverse_mapping)

    OUTPUT_FILEPATH = os.path.join(DECODED_PATH)
    os.makedirs(os.path.dirname(OUTPUT_FILEPATH), exist_ok=True)
    base64_to_file(decoded_base64, OUTPUT_FILEPATH)

    if DEBUG:
        if path_sections:
            print("Pfadabschnitte:", path_sections)
        print("Ausgabe-Dateipfad:", OUTPUT_FILEPATH)
        print("Entschl√ºsselter Pfad:", DECODED_PATH)

    if cleanup:
        os.remove(enc_path)
        os.remove(code_path)
        print("Cleanup erfolgreich.")


def DECODE_FOLDER_RECURSIVE(root_folder: str, cleanup=False, namespace=globals()):
    for dirpath, dirnames, filenames in os.walk(root_folder):
        for filename in filenames:
            if filename.endswith(".scff"):
                full_path = os.path.join(dirpath, filename)
                try:
                    print(f"Entschl√ºssele: {full_path}")
                    DECODE_MAIN_SAFE(full_path, cleanup=cleanup, namespace=namespace)
                except Exception as e:
                    print(f"Fehler beim Entschl√ºsseln von {full_path}: {e}")
